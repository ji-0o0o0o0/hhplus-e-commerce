# 📦 E-커머스 서비스 시나리오 분석

---

## 1️⃣ 잔액 충전 / 조회 기능

### 🔹 포인트 충전 API

- **입력값**
    - 사용자 ID
    - 충전 금액

- **입력값 검증**
  - 사용자 ID 검증 
    - 사용자 ID가 0 이하가 아닌지 확인
    - 해당 사용자 ID가 실제로 존재하는지 확인
  - 충전금액 검증
    - 충전 금액이 음수가 아닌지 확인
    - 1회 최대 충전 금액은 1,000,000원
    - 누적 충전 금액은 최대 5,000,000원

- **처리 로직**
    - 입력값 검증 통과하면, 사용자 포인트 잔액을 업데이트
    - 충전 이력 저장 

---

### 🔹 포인트 조회 API

- **입력값**
    - 사용자 ID

- **입력값 검증**
    - 사용자 ID가 0 이하가 아닌지 확인
    - 해당 사용자 ID가 실제로 존재하는지 확인

- **처리 로직**
    - 사용자 잔액(보유 포인트) 조회 후 반환

---

## 2️⃣ 상품 조회 기능

### 🔹 상품 목록 조회 API

- **응답 항목**
    - 상품 ID
    - 상품명
    - 가격
    - 잔여 수량

- **처리 로직 및 고려사항**
    - 조회 시점의 상품별 잔여 수량이 정확해야 함

---

## 3️⃣ 선착순 쿠폰 발급 / 조회 기능

### 🔹 쿠폰 발급 API

- **입력값**
    - 사용자 ID
    - 쿠폰 ID

- **입력값 검증**
    - 사용자 ID 검증
        - 사용자 ID가 0 이하가 아닌지 확인
        - 해당 사용자 ID가 실제로 존재하는지 확인
    - 쿠폰 ID 검증
      - 쿠폰 ID가 0 이하가 아닌지 확인
      - 해당 쿠폰이 실제 존재하는지 확인
      - 잔여 수량(remain_amount)이 1 이상인지 확인
      - 해당 사용자가 이미 발급받은 쿠폰인지 확인

- **처리 로직**
    - 입력값 검증 통과 하면, 쿠폰 발급 처리
    - 쿠폰 잔여 수량 차감

---

### 🔹 보유 쿠폰 조회 API

- **입력값**
    - 사용자 ID

- **입력값 검증**
  - 사용자 ID 검증
      - 사용자 ID가 0 이하가 아닌지 확인
      - 사용자 존재 여부 확인

- **처리 로직**
    - 입력값 검증 통과 하면, 해당 사용자가 보유 중인 쿠폰 목록 반환

---

## 4️⃣ 주문 / 결제 기능

### 🔹 주문 생성 API

- **입력값**
    - 사용자 ID
    - 쿠폰 ID (선택)
    - 구매 상품 목록: (상품 ID, 수량) 배열

- **입력값 검증**
  - 사용자 ID
    - 사용자 ID가 0 이하가 아닌지 확인
    - 해당 사용자 ID가 실제로 존재하는지 확인
  - 상품
    - 구매하고자 하는 상품 수량이 현재 재고 이하인지 확인
  - 쿠폰(쿠폰 ID가 존재할 경우)
      - 쿠폰이 실제 존재하는지 확인
      - 사용자 보유 쿠폰인지 확인
      - 쿠폰 유효기간(시작날짜, 종료날짜) 확인
      - 쿠폰 상태(is_used = true) 확인

- **처리 로직**
    - 할인 금액 계산 (쿠폰이 적용된 최종 결제 금액)
    - 주문 상태를 `NOT_PAID`로 저장
    - 주문 이력 저장 (사용자 ID, 상품 목록, 주문 총액 등)

- **비동기 처리**
    - 주문 생성 후 5분 내 결제되지 않으면:
        - 주문 상태를 `FAILED`로 변경
        - 재고 및 쿠폰 롤백 처리 필요

---

### 🔹 결제 API

- **입력값**
    - 사용자 ID
    - 주문 ID

- **입력값 검증**
  - 사용자 ID 검증
    - 사용자 ID가 0 이하가 아닌지 확인
    - 해당 사용자 ID가 실제로 존재하는지 확인
  - 주문 ID 검증
    - 주문 ID가 0 이하가 아닌지 확인
    - 해당 주문 ID가 실제로 존재하는지 확인
  - 사용자 보유 잔액
    - 해당 사용자의 보유 포인트 확인

- **결제 처리 로직**
    - 포인트 차감 및 차감 이력 저장
    - 주문 상태를 `PAID`로 업데이트
    - 주문 정보를 데이터 플랫폼으로 전송

- **예외 처리**
    - 결제 완료 후 데이터 플랫폼 전송 실패 시 롤백 여부 판단 필요 (트랜잭션 경계 설정)

---

## 5️⃣ 상위 상품 조회 기능

### 🔹 베스트셀러 조회 API

- **설명**  
  최근 3일간 가장 많이 팔린 상위 5개 상품 정보를 제공합니다.

- **처리 로직**
    - 매일 00시에 스케줄러가 각 상품의 일별 판매량을 집계
    - 베스트셀러 테이블에 랭킹 데이터 저장
    - 상위 5개 상품을 기준으로 정렬 및 반환



